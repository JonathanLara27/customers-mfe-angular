<div class="table-responsive table-container">
    @if (isLoading()) {
    <div class="loading-shade">
        <mat-spinner></mat-spinner>
    </div>
    }@else {
    <!-- Row shown when there is no matching data. -->
    <tr class="mat-row" *matNoDataRow>
        <td class="text-center" colspan="20">No se encontraron datos</td>
    </tr>
    }

    <table mat-table [dataSource]="tableDataSource()" class="mat-elevation-z8 table-border">

        @for (column of columns(); track $index) {
        <ng-container [matColumnDef]="column.field">
            <th mat-header-cell *matHeaderCellDef>
                <div class="text-center">
                    {{column.header}}
                </div>
            </th>
            <td mat-cell *matCellDef="let element">
                <div class="d-flex justify-content-center">
                    <div [ngClass]="[column.cellClass2 ? column.cellClass2(element) : column.cellClass]">
                        @switch (column.type) {
                            @case ('date') {
                                {{element[column.field] | date : 'dd/MM/yyyy'}}
                            }
                            @case ('datetime') {
                                {{element[column.field] | date : 'dd/MM/yyyy hh:mm:ss a'}}
                            }
                            @case ('number') {
                                @if (element[column.field] !== null && element[column.field] !== undefined) {
                                    {{element[column.field] | number:'1.2-2'}}
                                }@else {
                                    {{'0'}}
                                }
                            }
                            @default {
                                {{element[column.field]}}
                            }
                        }
                    </div>
                </div>
            </td>
        </ng-container>
        }

        @if (buttonColumn()) {
        <ng-container [matColumnDef]="buttonColumn()!.field" stickyEnd>
            <th mat-header-cell *matHeaderCellDef>
                <div class="text-center">
                    {{buttonColumn()!.header}}
                </div>
            </th>
            <td mat-cell *matCellDef="let element; let i=index">
                @if(showAction()[i] && getVisibleButtonsCount(element) > 1){
                <div class="d-flex justify-content-center">
                    <button mat-icon-button matTooltip="Ocultar acciones" (click)="changeViewActions(i)">
                        <mat-icon>keyboard_arrow_up</mat-icon>
                    </button>
                </div>
                <section class="d-flex justify-content-center">
                    <div [ngClass]="
                            {'button-group': true,
                            'single-button': getVisibleButtonsCount(element) === 1,
                            'multiple-buttons': getVisibleButtonsCount(element) > 1
                            }">
                        @for (button of buttonColumn().buttons; track $index) {
                        <app-action-button [button]="button" [element]="element" [isLoading]="isLoading()"
                            (action)="onButtonClick($event, element)"></app-action-button>
                        }
                    </div>
                </section>
                }
                @if(!showAction()[i] && getVisibleButtonsCount(element) > 1){
                <div class="d-flex justify-content-center">
                    <button mat-icon-button matTooltip="Ver acciones" (click)="changeViewActions(i)">
                        <mat-icon>keyboard_arrow_down</mat-icon>
                    </button>
                </div>
                }
            </td>
        </ng-container>
        }

        <tr mat-header-row *matHeaderRowDef="displayedColumns() sticky : true" class="header-table"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns();" class="element-row"></tr>

    </table>


</div>